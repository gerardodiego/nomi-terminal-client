#!/bin/bash

# replace "nomi-id", "your-name" and "account-id" as relevant

# Define bold code
BOLD='\033[1m'
NC='\033[0m'  # No Color (Reset)

while true
do
  # Display "your-name>" in bold
  echo -ne "${BOLD}your-name> ${NC}"
  
  # Read the message from the user
  read -r MESSAGE

  # Send the message to the endpoint and format the response from the Nomi
  RESPONSE=$(curl --silent --header 'Authorization: account-id' \
       --header 'Content-Type: application/json' \
       --data '{ "messageText": "'"$MESSAGE"'" }' \
       https://api.nomi.ai/v1/nomis/nomi-id/chat \
    | /usr/bin/jq -r '.replyMessage.text')

  # Check if the response is not empty or just whitespace
  if [[ -n "$RESPONSE" && ! "$RESPONSE" =~ ^[[:space:]]*$ ]]; then
    # Dynamically get terminal width
    TERM_WIDTH=$(tput cols)

    # Reformat response to fit current terminal width without breaking words
    echo -e "${BOLD}nomi-name> ${NC}$(echo "$RESPONSE" | fmt -w "$((TERM_WIDTH - 7))")"
  fi
done
